{"ast":null,"code":"var _toArray = require(\"/Users/heeje/Desktop/Projcet_A/Front_End/project 2/node_modules/@babel/runtime/helpers/toArray\");\n\nvar _slicedToArray = require(\"/Users/heeje/Desktop/Projcet_A/Front_End/project 2/node_modules/@babel/runtime/helpers/slicedToArray\");\n\n/*\n    Copyright 2018 The caver-js Authors\n    This file is part of the caver-js library.\n\n    The caver-js library is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    The caver-js library is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with the caver-js. If not, see <http://www.gnu.org/licenses/>.\n*/\nconst RLP = require('eth-lib/lib/rlp');\n\nconst Hash = require('eth-lib/lib/hash');\n\nconst utils = require('../../../caver-utils');\n\nconst _require = require('./transactionType'),\n      rlpEncodeForLegacyTransaction = _require.rlpEncodeForLegacyTransaction,\n      rlpEncodeForValueTransfer = _require.rlpEncodeForValueTransfer,\n      rlpEncodeForValueTransferMemo = _require.rlpEncodeForValueTransferMemo,\n      rlpEncodeForFeeDelegatedValueTransferMemoWithRatio = _require.rlpEncodeForFeeDelegatedValueTransferMemoWithRatio,\n      rlpEncodeForFeeDelegatedValueTransfer = _require.rlpEncodeForFeeDelegatedValueTransfer,\n      rlpEncodeForFeeDelegatedValueTransferWithRatio = _require.rlpEncodeForFeeDelegatedValueTransferWithRatio,\n      rlpEncodeForFeeDelegatedValueTransferMemo = _require.rlpEncodeForFeeDelegatedValueTransferMemo,\n      rlpEncodeForAccountUpdate = _require.rlpEncodeForAccountUpdate,\n      rlpEncodeForContractDeploy = _require.rlpEncodeForContractDeploy,\n      rlpEncodeForContractExecution = _require.rlpEncodeForContractExecution,\n      rlpEncodeForFeeDelegatedAccountUpdate = _require.rlpEncodeForFeeDelegatedAccountUpdate,\n      rlpEncodeForFeeDelegatedAccountUpdateWithRatio = _require.rlpEncodeForFeeDelegatedAccountUpdateWithRatio,\n      rlpEncodeForFeeDelegatedSmartContractDeploy = _require.rlpEncodeForFeeDelegatedSmartContractDeploy,\n      rlpEncodeForFeeDelegatedSmartContractDeployWithRatio = _require.rlpEncodeForFeeDelegatedSmartContractDeployWithRatio,\n      rlpEncodeForFeeDelegatedSmartContractExecution = _require.rlpEncodeForFeeDelegatedSmartContractExecution,\n      rlpEncodeForFeeDelegatedSmartContractExecutionWithRatio = _require.rlpEncodeForFeeDelegatedSmartContractExecutionWithRatio,\n      rlpEncodeForCancel = _require.rlpEncodeForCancel,\n      rlpEncodeForFeeDelegatedCancel = _require.rlpEncodeForFeeDelegatedCancel,\n      rlpEncodeForFeeDelegatedCancelWithRatio = _require.rlpEncodeForFeeDelegatedCancelWithRatio,\n      rlpEncodeForChainDataAnchoring = _require.rlpEncodeForChainDataAnchoring,\n      parseAccountKey = _require.parseAccountKey;\n\nconst creationNotSupportError = 'ACCOUNT_CREATION transaction type is not supported yet.';\n\nfunction encodeRLPByTxType(transaction) {\n  transaction.type = transaction.senderRawTransaction ? utils.getTxTypeStringFromRawTransaction(transaction.senderRawTransaction) : transaction.type;\n\n  switch (transaction.type) {\n    case 'ACCOUNT_CREATION':\n      throw new Error(creationNotSupportError);\n\n    case 'ACCOUNT_UPDATE':\n      return rlpEncodeForAccountUpdate(transaction);\n\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n      return rlpEncodeForFeeDelegatedAccountUpdate(transaction);\n\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedAccountUpdateWithRatio(transaction);\n\n    case 'VALUE_TRANSFER':\n      return rlpEncodeForValueTransfer(transaction);\n\n    case 'VALUE_TRANSFER_MEMO':\n      return rlpEncodeForValueTransferMemo(transaction);\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER':\n      return rlpEncodeForFeeDelegatedValueTransfer(transaction);\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedValueTransferWithRatio(transaction);\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO':\n      return rlpEncodeForFeeDelegatedValueTransferMemo(transaction);\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedValueTransferMemoWithRatio(transaction);\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY':\n      return rlpEncodeForFeeDelegatedSmartContractDeploy(transaction);\n\n    case 'SMART_CONTRACT_DEPLOY':\n      return rlpEncodeForContractDeploy(transaction);\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedSmartContractDeployWithRatio(transaction);\n\n    case 'SMART_CONTRACT_EXECUTION':\n      return rlpEncodeForContractExecution(transaction);\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION':\n      return rlpEncodeForFeeDelegatedSmartContractExecution(transaction);\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedSmartContractExecutionWithRatio(transaction);\n\n    case 'CANCEL':\n      return rlpEncodeForCancel(transaction);\n\n    case 'FEE_DELEGATED_CANCEL':\n      return rlpEncodeForFeeDelegatedCancel(transaction);\n\n    case 'FEE_DELEGATED_CANCEL_WITH_RATIO':\n      return rlpEncodeForFeeDelegatedCancelWithRatio(transaction);\n\n    case 'CHAIN_DATA_ANCHORING':\n      return rlpEncodeForChainDataAnchoring(transaction);\n\n    case 'LEGACY':\n    default:\n      return rlpEncodeForLegacyTransaction(transaction);\n  }\n} // case1) sig === [v, r, s]\n// case2) sig ===\n\n\nfunction makeRawTransaction(rlpEncoded, sig, transaction) {\n  const decodedValues = RLP.decode(rlpEncoded);\n  let rawTx;\n  transaction.type = transaction.senderRawTransaction ? utils.getTxTypeStringFromRawTransaction(transaction.senderRawTransaction) : transaction.type;\n\n  switch (transaction.type) {\n    case 'ACCOUNT_CREATION':\n      throw new Error(creationNotSupportError);\n\n    case 'VALUE_TRANSFER':\n    case 'VALUE_TRANSFER_MEMO':\n    case 'ACCOUNT_UPDATE':\n    case 'SMART_CONTRACT_DEPLOY':\n    case 'SMART_CONTRACT_EXECUTION':\n    case 'CANCEL':\n    case 'CHAIN_DATA_ANCHORING':\n      return _combineSenderRawTransaction(rlpEncoded, sig);\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER':\n    case 'FEE_DELEGATED_VALUE_TRANSFER_WITH_RATIO':\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO':\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO_WITH_RATIO':\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY':\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY_WITH_RATIO':\n    case 'FEE_DELEGATED_CANCEL':\n    case 'FEE_DELEGATED_CANCEL_WITH_RATIO':\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO':\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION':\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION_WITH_RATIO':\n      {\n        if (transaction.senderRawTransaction) {\n          const decoded = decodeFromRawTransaction(transaction.senderRawTransaction);\n          return _combineFeePayerRawTransaction(rlpEncoded, sig, transaction, decoded.signatures);\n        }\n\n        if (transaction.feePayer && transaction.feePayer !== '0x' && transaction.feePayerSignatures) {\n          return _combineFeePayerRawTransaction(rlpEncoded, transaction.feePayerSignatures, transaction, sig);\n        }\n\n        return _combineSenderRawTransaction(rlpEncoded, sig);\n      }\n\n    case 'LEGACY':\n    default:\n      rawTx = decodedValues.slice(0, 6).concat(sig[0]);\n      return {\n        rawTransaction: RLP.encode(rawTx),\n        signatures: sig[0],\n        feePayerSignatures: undefined\n      };\n  }\n}\n\nfunction _combineSenderRawTransaction(rlpEncoded, sig) {\n  const decodedValues = RLP.decode(rlpEncoded);\n\n  const _decodedValues = _slicedToArray(decodedValues, 1),\n        data = _decodedValues[0];\n\n  let _RLP$decode = RLP.decode(data),\n      _RLP$decode2 = _toArray(_RLP$decode),\n      txType = _RLP$decode2[0],\n      rawTx = _RLP$decode2.slice(1);\n\n  if (!Array.isArray(sig[0])) sig = [sig];\n  sig = refineSignatures(sig);\n  rawTx = [...rawTx, sig]; // set default feepayer's information in rawTx\n\n  const typeString = utils.getTxTypeStringFromRawTransaction(txType);\n  if (typeString !== undefined && typeString.includes('FEE_DELEGATED')) rawTx = [...rawTx, '0x', [['0x01', '0x', '0x']]];\n  return {\n    rawTransaction: txType + RLP.encode(rawTx).slice(2),\n    signatures: sig,\n    feePayerSignatures: undefined\n  };\n}\n\nfunction _combineFeePayerRawTransaction(rlpEncoded, feePayerSignatures, transaction, senderSignature) {\n  const decodedValues = RLP.decode(rlpEncoded);\n\n  const _decodedValues2 = _slicedToArray(decodedValues, 1),\n        data = _decodedValues2[0];\n\n  let _RLP$decode3 = RLP.decode(data),\n      _RLP$decode4 = _toArray(_RLP$decode3),\n      txType = _RLP$decode4[0],\n      rawTx = _RLP$decode4.slice(1);\n\n  if (!Array.isArray(feePayerSignatures[0])) feePayerSignatures = [feePayerSignatures];\n  senderSignature = refineSignatures(senderSignature);\n  feePayerSignatures = refineSignatures(feePayerSignatures);\n  rawTx = [...rawTx, senderSignature, transaction.feePayer.toLowerCase(), feePayerSignatures];\n  return {\n    rawTransaction: txType + RLP.encode(rawTx).slice(2),\n    signatures: senderSignature,\n    feePayerSignatures\n  };\n} // refineSignatures removes duplication and empty signatures\n\n\nfunction refineSignatures(sigArray) {\n  const set = new Set();\n  let result = [];\n\n  for (const sig of sigArray) {\n    if (sig.length > 0 && !utils.isEmptySig(sig)) {\n      const sigString = sig.join('');\n\n      if (!set.has(sigString)) {\n        set.add(sigString, true);\n        result.push(sig);\n      }\n    }\n  }\n\n  if (result.length === 0) result = [['0x01', '0x', '0x']];\n  return result;\n}\n\nfunction extractSignatures(rawTransaction) {\n  let senderSignatures = [];\n  let feePayerSignatures = [];\n\n  const decoded = _decodeFromRawTransaction(rawTransaction);\n\n  senderSignatures = senderSignatures.concat(decoded.signatures);\n\n  if (decoded.feePayerSignatures) {\n    feePayerSignatures = feePayerSignatures.concat(decoded.feePayerSignatures);\n  }\n\n  return {\n    senderSignatures,\n    feePayerSignatures,\n    decodedTransaction: decoded\n  };\n}\n\nfunction splitFeePayer(rawTransaction) {\n  const typeString = utils.getTxTypeStringFromRawTransaction(rawTransaction);\n  if (!typeString || !typeString.includes('FEE_DELEGATED')) throw new Error(\"Failed to split fee payer: not a fee delegated transaction type('\".concat(typeString || 'LEGACY', \"')\"));\n  const txType = rawTransaction.slice(0, 4);\n  const decodedValues = RLP.decode(utils.addHexPrefix(rawTransaction.slice(4)));\n  const detachFeePayer = decodedValues.splice(0, decodedValues.length - 2);\n  detachFeePayer.push('0x');\n  detachFeePayer.push([['0x01', '0x', '0x']]);\n  return {\n    senderRawTransaction: txType + RLP.encode(detachFeePayer).slice(2),\n    feePayer: decodedValues[0],\n    feePayerSignatures: decodedValues[1]\n  };\n}\n\nfunction decodeFromRawTransaction(rawTransaction, type) {\n  let decodeResult = _decodeFromRawTransaction(rawTransaction, type);\n\n  switch (decodeResult.type) {\n    case 'ACCOUNT_UPDATE':\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO':\n      {\n        decodeResult = parseAccountKey(decodeResult);\n      }\n  }\n\n  return decodeResult;\n}\n\nfunction _decodeFromRawTransaction(rawTransaction, type) {\n  let typeString = type;\n\n  if (typeString === undefined || typeString !== 'LEGACY') {\n    typeString = utils.getTxTypeStringFromRawTransaction(rawTransaction);\n\n    if (typeString === undefined) {\n      typeString = 'LEGACY';\n    } else {\n      rawTransaction = \"0x\".concat(rawTransaction.slice(4));\n    }\n  }\n\n  switch (typeString) {\n    case 'LEGACY':\n      {\n        const _RLP$decode5 = RLP.decode(rawTransaction),\n              _RLP$decode6 = _slicedToArray(_RLP$decode5, 9),\n              nonce = _RLP$decode6[0],\n              gasPrice = _RLP$decode6[1],\n              gas = _RLP$decode6[2],\n              to = _RLP$decode6[3],\n              value = _RLP$decode6[4],\n              data = _RLP$decode6[5],\n              v = _RLP$decode6[6],\n              r = _RLP$decode6[7],\n              s = _RLP$decode6[8];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          data,\n          v,\n          r,\n          s,\n          signatures: [v, r, s]\n        };\n      }\n\n    case 'VALUE_TRANSFER':\n      {\n        const _RLP$decode7 = RLP.decode(rawTransaction),\n              _RLP$decode8 = _slicedToArray(_RLP$decode7, 7),\n              nonce = _RLP$decode8[0],\n              gasPrice = _RLP$decode8[1],\n              gas = _RLP$decode8[2],\n              to = _RLP$decode8[3],\n              value = _RLP$decode8[4],\n              from = _RLP$decode8[5],\n              signatures = _RLP$decode8[6];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER':\n      {\n        const _RLP$decode9 = RLP.decode(rawTransaction),\n              _RLP$decode10 = _slicedToArray(_RLP$decode9, 9),\n              nonce = _RLP$decode10[0],\n              gasPrice = _RLP$decode10[1],\n              gas = _RLP$decode10[2],\n              to = _RLP$decode10[3],\n              value = _RLP$decode10[4],\n              from = _RLP$decode10[5],\n              signatures = _RLP$decode10[6],\n              feePayer = _RLP$decode10[7],\n              feePayerSignatures = _RLP$decode10[8];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_WITH_RATIO':\n      {\n        const _RLP$decode11 = RLP.decode(rawTransaction),\n              _RLP$decode12 = _slicedToArray(_RLP$decode11, 10),\n              nonce = _RLP$decode12[0],\n              gasPrice = _RLP$decode12[1],\n              gas = _RLP$decode12[2],\n              to = _RLP$decode12[3],\n              value = _RLP$decode12[4],\n              from = _RLP$decode12[5],\n              feeRatio = _RLP$decode12[6],\n              signatures = _RLP$decode12[7],\n              feePayer = _RLP$decode12[8],\n              feePayerSignatures = _RLP$decode12[9];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          feeRatio,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'VALUE_TRANSFER_MEMO':\n      {\n        const _RLP$decode13 = RLP.decode(rawTransaction),\n              _RLP$decode14 = _slicedToArray(_RLP$decode13, 8),\n              nonce = _RLP$decode14[0],\n              gasPrice = _RLP$decode14[1],\n              gas = _RLP$decode14[2],\n              to = _RLP$decode14[3],\n              value = _RLP$decode14[4],\n              from = _RLP$decode14[5],\n              data = _RLP$decode14[6],\n              signatures = _RLP$decode14[7];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO':\n      {\n        const _RLP$decode15 = RLP.decode(rawTransaction),\n              _RLP$decode16 = _slicedToArray(_RLP$decode15, 10),\n              nonce = _RLP$decode16[0],\n              gasPrice = _RLP$decode16[1],\n              gas = _RLP$decode16[2],\n              to = _RLP$decode16[3],\n              value = _RLP$decode16[4],\n              from = _RLP$decode16[5],\n              data = _RLP$decode16[6],\n              signatures = _RLP$decode16[7],\n              feePayer = _RLP$decode16[8],\n              feePayerSignatures = _RLP$decode16[9];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_VALUE_TRANSFER_MEMO_WITH_RATIO':\n      {\n        const _RLP$decode17 = RLP.decode(rawTransaction),\n              _RLP$decode18 = _slicedToArray(_RLP$decode17, 11),\n              nonce = _RLP$decode18[0],\n              gasPrice = _RLP$decode18[1],\n              gas = _RLP$decode18[2],\n              to = _RLP$decode18[3],\n              value = _RLP$decode18[4],\n              from = _RLP$decode18[5],\n              data = _RLP$decode18[6],\n              feeRatio = _RLP$decode18[7],\n              signatures = _RLP$decode18[8],\n              feePayer = _RLP$decode18[9],\n              feePayerSignatures = _RLP$decode18[10];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          feeRatio,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'ACCOUNT_CREATION':\n      {\n        throw new Error(creationNotSupportError);\n      }\n\n    case 'ACCOUNT_UPDATE':\n      {\n        const _RLP$decode19 = RLP.decode(rawTransaction),\n              _RLP$decode20 = _slicedToArray(_RLP$decode19, 6),\n              nonce = _RLP$decode20[0],\n              gasPrice = _RLP$decode20[1],\n              gas = _RLP$decode20[2],\n              from = _RLP$decode20[3],\n              accountKey = _RLP$decode20[4],\n              signatures = _RLP$decode20[5];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          accountKey,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE':\n      {\n        const _RLP$decode21 = RLP.decode(rawTransaction),\n              _RLP$decode22 = _slicedToArray(_RLP$decode21, 8),\n              nonce = _RLP$decode22[0],\n              gasPrice = _RLP$decode22[1],\n              gas = _RLP$decode22[2],\n              from = _RLP$decode22[3],\n              accountKey = _RLP$decode22[4],\n              signatures = _RLP$decode22[5],\n              feePayer = _RLP$decode22[6],\n              feePayerSignatures = _RLP$decode22[7];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          accountKey,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_ACCOUNT_UPDATE_WITH_RATIO':\n      {\n        const _RLP$decode23 = RLP.decode(rawTransaction),\n              _RLP$decode24 = _slicedToArray(_RLP$decode23, 9),\n              nonce = _RLP$decode24[0],\n              gasPrice = _RLP$decode24[1],\n              gas = _RLP$decode24[2],\n              from = _RLP$decode24[3],\n              accountKey = _RLP$decode24[4],\n              feeRatio = _RLP$decode24[5],\n              signatures = _RLP$decode24[6],\n              feePayer = _RLP$decode24[7],\n              feePayerSignatures = _RLP$decode24[8];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          accountKey,\n          feeRatio,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'SMART_CONTRACT_DEPLOY':\n      {\n        const _RLP$decode25 = RLP.decode(rawTransaction),\n              _RLP$decode26 = _slicedToArray(_RLP$decode25, 10),\n              nonce = _RLP$decode26[0],\n              gasPrice = _RLP$decode26[1],\n              gas = _RLP$decode26[2],\n              to = _RLP$decode26[3],\n              value = _RLP$decode26[4],\n              from = _RLP$decode26[5],\n              data = _RLP$decode26[6],\n              humanReadable = _RLP$decode26[7],\n              codeFormat = _RLP$decode26[8],\n              signatures = _RLP$decode26[9];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          humanReadable: humanReadable === '0x01',\n          codeFormat,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY':\n      {\n        const _RLP$decode27 = RLP.decode(rawTransaction),\n              _RLP$decode28 = _slicedToArray(_RLP$decode27, 12),\n              nonce = _RLP$decode28[0],\n              gasPrice = _RLP$decode28[1],\n              gas = _RLP$decode28[2],\n              to = _RLP$decode28[3],\n              value = _RLP$decode28[4],\n              from = _RLP$decode28[5],\n              data = _RLP$decode28[6],\n              humanReadable = _RLP$decode28[7],\n              codeFormat = _RLP$decode28[8],\n              signatures = _RLP$decode28[9],\n              feePayer = _RLP$decode28[10],\n              feePayerSignatures = _RLP$decode28[11];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          humanReadable: humanReadable === '0x01',\n          codeFormat,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_DEPLOY_WITH_RATIO':\n      {\n        const _RLP$decode29 = RLP.decode(rawTransaction),\n              _RLP$decode30 = _slicedToArray(_RLP$decode29, 13),\n              nonce = _RLP$decode30[0],\n              gasPrice = _RLP$decode30[1],\n              gas = _RLP$decode30[2],\n              to = _RLP$decode30[3],\n              value = _RLP$decode30[4],\n              from = _RLP$decode30[5],\n              data = _RLP$decode30[6],\n              humanReadable = _RLP$decode30[7],\n              feeRatio = _RLP$decode30[8],\n              codeFormat = _RLP$decode30[9],\n              signatures = _RLP$decode30[10],\n              feePayer = _RLP$decode30[11],\n              feePayerSignatures = _RLP$decode30[12];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          humanReadable: humanReadable === '0x01',\n          feeRatio,\n          codeFormat,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'SMART_CONTRACT_EXECUTION':\n      {\n        const _RLP$decode31 = RLP.decode(rawTransaction),\n              _RLP$decode32 = _slicedToArray(_RLP$decode31, 8),\n              nonce = _RLP$decode32[0],\n              gasPrice = _RLP$decode32[1],\n              gas = _RLP$decode32[2],\n              to = _RLP$decode32[3],\n              value = _RLP$decode32[4],\n              from = _RLP$decode32[5],\n              data = _RLP$decode32[6],\n              signatures = _RLP$decode32[7];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION':\n      {\n        const _RLP$decode33 = RLP.decode(rawTransaction),\n              _RLP$decode34 = _slicedToArray(_RLP$decode33, 10),\n              nonce = _RLP$decode34[0],\n              gasPrice = _RLP$decode34[1],\n              gas = _RLP$decode34[2],\n              to = _RLP$decode34[3],\n              value = _RLP$decode34[4],\n              from = _RLP$decode34[5],\n              data = _RLP$decode34[6],\n              signatures = _RLP$decode34[7],\n              feePayer = _RLP$decode34[8],\n              feePayerSignatures = _RLP$decode34[9];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_SMART_CONTRACT_EXECUTION_WITH_RATIO':\n      {\n        const _RLP$decode35 = RLP.decode(rawTransaction),\n              _RLP$decode36 = _slicedToArray(_RLP$decode35, 11),\n              nonce = _RLP$decode36[0],\n              gasPrice = _RLP$decode36[1],\n              gas = _RLP$decode36[2],\n              to = _RLP$decode36[3],\n              value = _RLP$decode36[4],\n              from = _RLP$decode36[5],\n              data = _RLP$decode36[6],\n              feeRatio = _RLP$decode36[7],\n              signatures = _RLP$decode36[8],\n              feePayer = _RLP$decode36[9],\n              feePayerSignatures = _RLP$decode36[10];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          to,\n          value,\n          from,\n          data,\n          feeRatio,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'CANCEL':\n      {\n        const _RLP$decode37 = RLP.decode(rawTransaction),\n              _RLP$decode38 = _slicedToArray(_RLP$decode37, 5),\n              nonce = _RLP$decode38[0],\n              gasPrice = _RLP$decode38[1],\n              gas = _RLP$decode38[2],\n              from = _RLP$decode38[3],\n              signatures = _RLP$decode38[4];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n\n    case 'FEE_DELEGATED_CANCEL':\n      {\n        const _RLP$decode39 = RLP.decode(rawTransaction),\n              _RLP$decode40 = _slicedToArray(_RLP$decode39, 7),\n              nonce = _RLP$decode40[0],\n              gasPrice = _RLP$decode40[1],\n              gas = _RLP$decode40[2],\n              from = _RLP$decode40[3],\n              signatures = _RLP$decode40[4],\n              feePayer = _RLP$decode40[5],\n              feePayerSignatures = _RLP$decode40[6];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'FEE_DELEGATED_CANCEL_WITH_RATIO':\n      {\n        const _RLP$decode41 = RLP.decode(rawTransaction),\n              _RLP$decode42 = _slicedToArray(_RLP$decode41, 8),\n              nonce = _RLP$decode42[0],\n              gasPrice = _RLP$decode42[1],\n              gas = _RLP$decode42[2],\n              from = _RLP$decode42[3],\n              feeRatio = _RLP$decode42[4],\n              signatures = _RLP$decode42[5],\n              feePayer = _RLP$decode42[6],\n              feePayerSignatures = _RLP$decode42[7];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          feeRatio,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures,\n          feePayer,\n          payerV: feePayerSignatures[0][0],\n          payerR: feePayerSignatures[0][1],\n          payerS: feePayerSignatures[0][2],\n          feePayerSignatures\n        };\n      }\n\n    case 'CHAIN_DATA_ANCHORING':\n      {\n        const _RLP$decode43 = RLP.decode(rawTransaction),\n              _RLP$decode44 = _slicedToArray(_RLP$decode43, 6),\n              nonce = _RLP$decode44[0],\n              gasPrice = _RLP$decode44[1],\n              gas = _RLP$decode44[2],\n              from = _RLP$decode44[3],\n              data = _RLP$decode44[4],\n              signatures = _RLP$decode44[5];\n\n        return {\n          type: typeString,\n          nonce,\n          gasPrice,\n          gas,\n          from,\n          data: data,\n          v: signatures[0][0],\n          r: signatures[0][1],\n          s: signatures[0][2],\n          signatures\n        };\n      }\n  }\n}\n\nfunction overwriteSignature(rawTransaction, txObj, signature, feePayerSignature) {\n  if (signature === undefined) {\n    signature = [txObj.v, txObj.r, txObj.s];\n  }\n\n  if (txObj.type.includes('FEE_DELEGATED') && feePayerSignature === undefined) {\n    feePayerSignature = [txObj.payerV, txObj.payerR, txObj.payerS];\n  }\n\n  if (txObj.type === 'LEGACY') {\n    let decodeLegacy = RLP.decode(rawTransaction);\n    decodeLegacy = decodeLegacy.slice(0, 6).concat(signature);\n    return RLP.encode(decodeLegacy);\n  }\n\n  const type = rawTransaction.slice(0, 4);\n  const typeDetached = \"0x\".concat(rawTransaction.slice(4));\n  const data = RLP.decode(typeDetached);\n\n  if (txObj.type.includes('FEE_DELEGATED')) {\n    data[data.length - 3] = [signature];\n    data[data.length - 1] = [feePayerSignature];\n  } else {\n    data[data.length - 1] = [signature];\n  }\n\n  return type + RLP.encode(data).slice(2);\n}\n\nfunction getSenderTxHash(rawTransaction) {\n  const typeString = utils.getTxTypeStringFromRawTransaction(rawTransaction);\n  if (typeString === undefined || !typeString.includes('FEE_DELEGATED')) return Hash.keccak256(rawTransaction);\n  const type = rawTransaction.slice(0, 4);\n  const typeDetached = \"0x\".concat(rawTransaction.slice(4));\n  const data = RLP.decode(typeDetached);\n  return Hash.keccak256(type + RLP.encode(data.slice(0, data.length - 2)).slice(2));\n}\n\nmodule.exports = {\n  encodeRLPByTxType,\n  makeRawTransaction,\n  decodeFromRawTransaction,\n  overwriteSignature,\n  getSenderTxHash,\n  splitFeePayer,\n  extractSignatures\n};","map":null,"metadata":{},"sourceType":"script"}