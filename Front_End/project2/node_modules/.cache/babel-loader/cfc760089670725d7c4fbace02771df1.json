{"ast":null,"code":"/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/**\n * Modified hard-coded new Method({ ... }) array structure by exporting it to caver-rtm(rpc). 2018-07\n */\nvar core = require('../../../caver-core');\n\nvar Method = require('../../../caver-core-method');\n\nvar utils = require('../../../caver-utils');\n\nvar Net = require('../../../caver-net');\n\nvar formatters = require('../../../caver-core-helpers').formatters;\n\nconst rpc = require('../../../caver-rtm').rpc;\n\nvar Personal = function Personal(...args) {\n  var _this = this; // sets _requestmanager\n\n  /**\n   * 대부분의 web3 패키지들과 유사하게 requestManager를 붙여준다.\n   */\n\n\n  core.packageInit(this, args);\n  this.net = new Net(this.currentProvider);\n  /**\n   * defaultAccount와 defaultBlock을 각각 null과 'latest'로 초기화 해준다.\n   * 여기서 정의된 것들은 Object.defineProperty... 에 의해서 다음과 같이 접근할 수 있다.\n   * cav.klay.personal.defaultAccount\n   * cav.klay.personal.defaultBlock\n   */\n\n  var defaultAccount = null;\n  var defaultBlock = 'latest';\n  /**\n   * Object.defineProperty는 말 그대로 object에 property를 붙여주는데,\n   * this.defaultAccount 로 '값에 접근할 때' -> get 함수를 콜하고\n   * this.defaultAccount = '???' 와 같이 '값을 쓸 때' -> set 함수를 콜하는 식이다.\n   * 값을 쓸 때 '쓴 값' (위의 예에서 '???')은 set 함수의 첫 번째 parameter에 담기게 된다.\n   */\n\n  Object.defineProperty(this, 'defaultAccount', {\n    get: function () {\n      return defaultAccount;\n    },\n    set: function (val) {\n      if (val) {\n        /**\n         * util을 통해 checksumaddress로 변환.\n         * !/^(0x)?[0-9a-f]{40}$/i.test(address) 정규식 처리를 통해 올바른 주소인지도 확인한다.\n         * \"0x로 시작하면서 && 0-9a-f로 이루어진 문자 40자리로 구성되어 있을 것.\"\n         */\n        defaultAccount = utils.toChecksumAddress(formatters.inputAddressFormatter(val));\n      } // update defaultBlock\n\n      /**\n       * 이 패키지에서 정의된 모든 method를 돌면서 defaultAccount를 붙여준다.\n       */\n\n\n      methods.forEach(function (method) {\n        method.defaultAccount = defaultAccount;\n      });\n      return val;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, 'defaultBlock', {\n    get: function () {\n      return defaultBlock;\n    },\n    set: function (val) {\n      if (!utils.isValidBlockNumberCandidate(val)) {\n        throw new Error('Invalid default block number.');\n        return;\n      }\n\n      defaultBlock = val; // update defaultBlock\n\n      /**\n       * 이 패키지에서 정의된 모든 method를 돌면서 defaultBlock을 붙여준다.\n       */\n\n      methods.forEach(function (method) {\n        method.defaultBlock = defaultBlock;\n      });\n      return val;\n    },\n    enumerable: true\n  });\n  /**\n   * jsonRPC로 보낼 메서드들에 대해서 정의하고 있다.\n   * getAccounts, newAccount, unlockAccount, lockAccount,\n   * importRawKey, sendTransaction, signTransaction, sign,\n   * ecRecover 에 대해서 정의되어 있으며, 각각에 대한 json rpc call시의 method는\n   * 'call' 이라는 property에 정의해놓는다. ex) getAccounts -> 'personal_listAccounts'\n   */\n\n  var methods = [rpc.personal.newAccount, rpc.personal.unlockAccount, rpc.personal.lockAccount, rpc.personal.importRawKey, rpc.personal.sendTransaction, rpc.personal.signTransaction, rpc.personal.sign, rpc.personal.ecRecover];\n  /**\n   * 정의한 methods들을 이 객체에 attach 해주고, 각 method에 request manager를 달아준다.\n   * 추가적으로 defaultBlock, defaultAccount도 달아준다.\n   */\n\n  methods.forEach(function (method) {\n    method.attachToObject(_this);\n    method.setRequestManager(_this._requestManager);\n    method.defaultBlock = _this.defaultBlock;\n    method.defaultAccount = _this.defaultAccount;\n  });\n};\n\nmodule.exports = Personal;","map":null,"metadata":{},"sourceType":"script"}